<div class="container mt-4">
  <h1 class="text-center mb-3" style="font-family: auto; color: burlywood;"><b>WCM MPI 2</b><sup>nd</sup> <b>
      Seminar</b></h1>
  <div class="d-flex justify-content-between mb-3">
    <input type="text" class="form-control w-25" placeholder="Search by name / number / scannerId" [(ngModel)]="searchText"
      (input)="search()" />
    <button class="btn btn-success" style="margin-left: 710px;" [routerLink]="['/scan']"
      routerLinkActive="router-link-active">
      Scanner <i class="bi bi-upc-scan"></i>
    </button>
    <button class="btn btn-dark" (click)="openAddModal()">
      + Add Member
    </button>
  </div>
<div class="table-wrapper">
  <table class="table table-bordered table-hover table-scroll">
    <thead class="table-primary">
      <tr>
        <th width="10%">Scanner Id</th>
        <th width="25%">Full Name</th>
        <th width="10%">Mobile No</th>
        <th width="25%">Email</th>
        <th width="10%">Reg Fees</th>
        <th width="10%">Attend Status</th>
        <th width="10%">Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let m of filteredMembers">
        <td width="10%">{{ m.scannerId }}</td>
        <td width="25%">{{ m.fullName }}</td>
        <td width="10%">{{ m.mobileNumber }}</td>
        <td width="25%">{{ m.email }}</td>

        <!-- Handle null safely -->
        <td width="10%">
          {{ m.registrationFees !== null ? m.registrationFees : 'â€”' }}
        </td>

        <td width="10%">
          <span class="badge" [ngClass]="{
    'bg-success': m.attendanceStatus === 'ATTENDED',
    'bg-danger': !m.attendanceStatus || m.attendanceStatus === 'NOT ATTENDED'
  }">
            {{ m.attendanceStatus || 'NOT ATTENDED' }}
          </span>
        </td>
        <td width="10%">
          <button class="btn btn-action btn-edit me-2" (click)="openEditModal(m)">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button *ngIf="!m.attendanceStatus || m.attendanceStatus != 'ATTENDED'" class="btn btn-action btn-edit"
            (click)="approve(m)">
            <i class="bi bi-check-square-fill" style="color: #00f885de;"></i>
          </button>
          <!-- <button
          class="btn btn-action btn-delete"
          (click)="deleteMember(m.registrationId)">
          <i class="bi bi-trash"></i>
        </button> -->
        </td>
      </tr>
    </tbody>
  </table>
</div>
</div>

<!-- FORM MODAL -->
<div *ngIf="showModal" class="modal-backdrop-custom">
  <div class="modal-custom">
    <div class="modal-header bg-primary text-white">
      <h5 class="mb-0">
        {{ isEditMode ? 'Edit Member' : 'Add Member' }}
      </h5>
      <button class="btn-close btn-close-white" (click)="showModal=false"></button>
    </div>
    <div class="modal-body">
      <form [formGroup]="form">
        <formly-form [form]="form" [fields]="fields" [model]="model">
        </formly-form>
      </form>
    </div>
    <div class="modal-footer d-flex justify-content-end gap-2">
      <button class="btn btn-outline-secondary" (click)="showModal=false">Cancel</button>
      <button class="btn btn-primary" (click)="save()">
        {{ isEditMode ? 'Update' : 'Save' }}
      </button>
    </div>
  </div>
</div>